\section{実行プロセスと生成物の変遷}
\label{sec:impl_process}

本節では，実装したシステムが実際にどのように機能し，各フェーズでデータがどのように変換されていくかを，
具体的な家電操作シナリオを用いて詳細に追跡する。
検証の対象として，一般家庭に広く普及している全自動洗濯機における「標準コースでの洗濯開始」というタスクを取り上げる。

このタスクを選定した理由は，単一のボタンを押すだけの操作とは異なり，
「電源ボタン」と「スタートボタン」という複数の物理デバイスを，
文脈に基づいた正しい順序で操作しなければ目的を達成できないためである。
例えば，電源を入れる前にスタートボタンを押しても機能しないように，
物理操作には明確な依存関係が存在しており，本システムがマニュアルからこの順序構造を正しく抽出できるかを検証するのに適している。

入力として与えるマニュアルのテキストには，
「洗濯を始めるには，まず電源ボタンを押します。コースが標準に設定されていることを確認し，
最後にスタートボタンを押してください」
といった，自然言語による手順記述が含まれているものとする。
本システムは，この非構造化テキストから「電源」$\to$「スタート」という操作ロジックを抽出し，
最終的に物理ボタンを駆動するコードへと変換する。
以下に，この一連の処理プロセスを時系列に沿って 4 つのステップに分解し，各段階での生成物の変遷を示す。

\subsection{Step 1: デバイスマップの作成 (Preparation)}

次に，物理的に SwitchBot Bot を家電の該当するボタン位置に取り付ける。
続いて，生成された定義ファイルを編集し，
物理的な Bot の ID と，マニュアル上で使われているボタン名称との対応関係を記述する（図 \ref{fig:example_map}）。
具体的には，各デバイスエントリの \texttt{label} フィールドに対し，
「電源ボタン」や「スタート」といった自然言語のラベルを付与する。
また，複数のボットがどの家電に属しているかを識別するため，
\texttt{appliance} フィールドにも「洗濯機」等の名称を設定する。
この定義により，システムは「電源ボタンを押す」という抽象的な指示を，
特定の物理デバイス ID（例: \texttt{E1...}）に対するコマンドへと変換可能となる。

\input{figures/code_map_example}

\subsection{Step 2: マニュアル解析と IR 生成 (Analyzer)}
次に，マニュアルテキストと上記のマップを入力として \texttt{generate-doc} コマンドを実行する。
LLM は記述を解析して「電源」$\to$「スタート」のシーケンスを抽出し，これを中間表現 (IR) として構造化する。
具体的には，\textbf{OpenAPI 定義 (\texttt{openapi.json})} に \texttt{POST /washing-machine/start} を定義し，
対となる \textbf{操作フロー定義 (\texttt{switchbot\_flow.json})} に，
図~\ref{fig:example_flow} に示すステップ配列（\texttt{operationId: "startMachine"}）を出力する。

\input{figures/code_flow_example}

\subsection{Step 3: コード生成と実装注入 (Synthesizer \& Injector)}
続いて，\texttt{generate-api} コマンドにより Flask サーバのスタブが生成され，
\texttt{implement} コマンドによって制御ロジックが注入される。
Injector は \texttt{switchbot\_flow.json} を読み込み，ラベル「電源ボタン」を物理 ID \texttt{"E16A82C65393"}等 に解決した上で，
図 ~\ref{fig:example_code} のような Python コードをコントローラ内に展開する

\input{figures/code_py_example}

このプロセスは決定論的であり，生成されるコードは常に構文的に正しいことが保証される。

\subsection{Step 4: 実行と動作確認}
生成されたサーバを起動し，クライアントから \texttt{/washing-machine/start} にリクエストを送信すると，
プログラムは定義された順序に従って SwitchBot Cloud API を呼び出す。
その結果，物理空間にある 2 つの Bot が順次動作し，洗濯機のボタンが物理的に押下され，運転が開始される。

以上のプロセスにより，マニュアルの入力から物理デバイスの操作に至るまでの一連の流れが，
人手によるコーディングなしに自動化されていることが確認できる。
